/* simple-tree-component v1.2.0,, @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["simple-tree-component"]=t()}(this,(function(){"use strict";const e={nodes:[],searchBar:!0,searchBarFocus:!1,searchMode:"OnlyMatches",searchPlaceholder:"",highlightSearchResults:!1,watermark:"Please select a value...",noNodesMessage:"No items found.",css:{dropdownHolder:""},templateSelectedText:e=>e.label,checkboxes:{active:!1,recursive:!1},clearButton:!1,scrollContainer:null,defaultDropdownHeight:300,dragAndDrop:!1};var t={SimpleTree:"simple-tree",SimpleTreeReadOnly:"simple-tree-readonly",SimpleTreeViewOnly:"simple-tree-view-only",SimpleTreeDropdownHolder:"simple-tree-dropdown-holder",SimpleTreeSingleSelectBox:"simple-tree-single-selectbox",SimpleTreeMultiSelectBox:"simple-tree-multi-selectbox",SimpleTreeInputContainer:"simple-tree-input-container",SimpleTreePillboxHolder:"simple-tree-pillbox-holder",SimpleTreePillboxCross:"simple-tree-pillbox-cross",SimpleTreeCross:"simple-tree-cross",SimpleTreeClearable:"simple-tree-clearable",SimpleTreeSelectedLabel:"simple-tree-selected-label",SimpleTreeSelectedLabelWatermark:"simple-tree-selected-label-watermark",SimpleTreeChevronUp:"simple-tree-chevron-up",SimpleTreeChevronDown:"simple-tree-chevron-down",SimpleTreeEmphasize:"simple-tree-emphasize-icon",SimpleTreeEmphasized:"simple-tree-emphasized",SimpleTreeNodeContainer:"simple-tree-node-container",SimpleTreeNodeContainerRoot:"simple-tree-node-container-root",SimpleTreeNodeText:"simple-tree-node-text",SimpleTreeNodeSelected:"simple-tree-node-selected",SimpleTreeNodeSelectable:"simple-tree-node-selectable",SimpleTreeNodeHovered:"simple-tree-node-hovered",SimpleTreeNodeArrow:"simple-tree-node-arrow",SimpleTreeNodeWrapper:"simple-tree-node-wrapper",SimpleTreeParentNode:"simple-tree-parent-node",SimpleTreeNodeChevronContainer:"simple-tree-node-chevron-container",SimpleTreeNodeChevronClickable:"simple-tree-node-chevron-clickable",SimpleTreeNodeChevronDown:"simple-tree-node-chevron-down",SimpleTreeNodeChevronRight:"simple-tree-node-chevron-right",SimpleTreeNodeCheckbox:"simple-tree-node-checkbox",SimpleTreeNodeCheckboxDisabled:"simple-tree-node-checkbox-disabled",SimpleTreeNodeCheckboxSelected:"simple-tree-node-checkbox-selected"},s={SelectionChanged:"selectionChanged",SelectionChanging:"selectionChanging",NodeIndexChanged:"nodeIndexChanged",_NodeSelected:"_nodeSelected",EscapePressed:"_escapePressed",HoverChanged:"_hoverChanged",FilterChanged:"_filterChanged"};class i{constructor(e,t,s){this.eventManager=e,this.dataService=t,this.readOnly=s,this.hoveredNodeValue=null,this.boundKeyUp=this.handleKeyUp.bind(this)}initialize(){window.addEventListener("keyup",this.boundKeyUp)}destroy(){window.removeEventListener("keyup",this.boundKeyUp)}setHoveredNodeValue(e){this.hoveredNodeValue=e}setReadOnly(e){this.readOnly=e}handleKeyUp(e){if(this.readOnly)return e.preventDefault(),void e.stopPropagation();if("Escape"===e.code)return void this.eventManager.publish(s.EscapePressed);const i=this.dataService.getFlattedClickableNodeValues(),l=null===this.hoveredNodeValue?-1:i.indexOf(this.hoveredNodeValue);let r=l;if("ArrowUp"===e.code)r=l>0?l-1:i.length-1;else if("ArrowDown"===e.code)r=-1!==l&&l<i.length-1?l+1:0;else if(("Enter"===e.code||"NumpadEnter"===e.code)&&i[r]){const t=this.dataService.toggleNodeSelected(i[r]);this.eventManager.publish(s._NodeSelected,t,e)}if(r!==l&&i[r]){this.hoveredNodeValue=i[r];const e=this.dataService.getNode(this.hoveredNodeValue);this.eventManager.publish(s.HoverChanged,e);const l=document.getElementById(e.uid),n=document.getElementsByClassName(t.SimpleTreeNodeContainer)[0];n.scrollHeight>n.clientHeight&&n.scrollTo({top:l.offsetTop-n.offsetHeight})}e.preventDefault(),e.stopPropagation()}}function l(e,t,...s){const i=document.createElement(t);return i.classList.add(...s.filter((e=>e))),e.appendChild(i),i}function r(e,...t){return l(e,"div",...t)}function n(){const e=t.SimpleTreeDropdownHolder;let s=document.body.querySelector(`.${e}`);return s||(s=r(document.body,e),s.style.display="none"),s}function o(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class d{constructor(e){this.setNodeIndex=e,this.draggedId=null,this.boundOnDragStart=this.onDragStart.bind(this),this.boundOnDragOver=this.onDragOver.bind(this),this.boundOnDrop=this.onDrop.bind(this)}initialize(e){e.setAttribute("draggable","true"),e.addEventListener("dragstart",this.boundOnDragStart),e.addEventListener("dragover",this.boundOnDragOver),e.addEventListener("drop",this.boundOnDrop)}destroy(e){e.removeAttribute("draggable"),e.removeEventListener("dragstart",this.boundOnDragStart),e.removeEventListener("dragover",this.boundOnDragOver),e.removeEventListener("drop",this.boundOnDrop)}onDragStart(e){const t=e.target;t.hasAttribute("draggable")&&(t.setAttribute("data-dragging","true"),this.draggedId=t.id,e.dataTransfer&&(e.dataTransfer.effectAllowed="move"))}onDragOver(e){var t,s,i;e.preventDefault();const l=this.getTargetListItem(e.target);if(!l)return;const{elements:r,ids:n}=this.getSameLevelNodes(l),o=null===(t=r.find((e=>"true"===e.getAttribute("data-dragging"))))||void 0===t?void 0:t.id;if(!o)return;if(!n.includes(o))return;const d=document.getElementById(o);if(!d)return;const a=l.getBoundingClientRect(),h=a.y+a.height/2;e.clientY-h>0?null===(s=l.parentElement)||void 0===s||s.insertBefore(d,l.nextSibling):null===(i=l.parentElement)||void 0===i||i.insertBefore(d,l)}onDrop(e){var t;if(e.preventDefault(),e.stopPropagation(),this.draggedId){null===(t=document.getElementById(this.draggedId))||void 0===t||t.removeAttribute("data-dragging");const{ids:e}=this.getSameLevelNodes(document.getElementById(this.draggedId));this.setNodeIndex(this.draggedId,e.indexOf(this.draggedId))}}getTargetListItem(e){for(;e.parentElement&&"LI"!==e.tagName;)e=e.parentElement;return e}getSameLevelNodes(e){var t;const s=Array.from((null===(t=e.parentElement)||void 0===t?void 0:t.children)||[]),i=s.map((e=>e.id));return{elements:s,ids:i}}}class a{constructor(e,t,l,r,n){this.element=e,this.config=t,this.dataService=l,this.eventManager=r,this.readOnly=n,this.highlightedNode=null,this.hoveredNode=null,this.searchTextInput=null,this.searchTextInputEvent=null,this.keyEventHandler=new i(this.eventManager,this.dataService,this.readOnly),this.dragAndDropHandler=new d(((e,t)=>{const i=this.dataService.setNodeIndex(e,t);this.eventManager.publish(s.NodeIndexChanged,{node:i,newIndex:t})})),this.subscription=this.eventManager.subscribe(s.HoverChanged,(e=>this.hoverNode(e)))}destroy(){this.deactivateKeyListener(),this.config.dragAndDrop&&this.removeDragAndDropListeners(),this.subscription&&(this.subscription.dispose(),this.subscription=null);const e=this.getNodeContainer();e&&(e.innerHTML=""),this.searchTextInput&&this.searchTextInputEvent&&(this.searchTextInput.removeEventListener("input",this.searchTextInputEvent),this.searchTextInputEvent=null)}activateKeyListener(){this.keyEventHandler.initialize()}deactivateKeyListener(){this.keyEventHandler.destroy()}removeDragAndDropListeners(){const e=this.getNodeContainer();Array.from(null==e?void 0:e.querySelectorAll("li")).forEach((e=>this.dragAndDropHandler.destroy(e)))}setNodeUiState(e,s,i){var l,r,n;return e&&s===e.value||null===(l=this.element.querySelector(`.${t.SimpleTreeNodeWrapper}.${i}`))||void 0===l||l.classList.remove(i),null!==e?(null===(n=null===(r=document.getElementById(e.uid))||void 0===r?void 0:r.querySelector(`.${t.SimpleTreeNodeWrapper}`))||void 0===n||n.classList.add(i),e.value):null}highlightNode(e){this.highlightedNode=this.setNodeUiState(e,this.highlightedNode,t.SimpleTreeNodeSelected)}hoverNode(e){this.hoveredNode=this.setNodeUiState(e,this.hoveredNode,t.SimpleTreeNodeHovered),this.keyEventHandler.setHoveredNodeValue(this.hoveredNode)}renderContent(){this.element.innerHTML="",this.createBasicHtml(),this.dataService.filter("",this.config.searchMode),this.renderTree()}createBasicHtml(){if(this.config.searchBar){const e=document.createElement("div");e.classList.add(t.SimpleTreeInputContainer),this.searchTextInput=document.createElement("input"),this.searchTextInput.type="text",this.searchTextInput.placeholder=this.config.searchPlaceholder,this.config.searchBarFocus&&setTimeout((()=>{var e;return null===(e=this.searchTextInput)||void 0===e?void 0:e.focus()}),0),this.searchTextInputEvent=e=>{this.dataService.filter(e.target.value,this.config.searchMode),this.renderTree(),this.eventManager.publish(s.FilterChanged)},this.searchTextInput.addEventListener("input",this.searchTextInputEvent),e.appendChild(this.searchTextInput),this.element.appendChild(e)}const e=document.createElement("div");e.classList.add(t.SimpleTreeNodeContainer),this.element.appendChild(e)}getNodeContainer(){return this.element.querySelector(`div.${t.SimpleTreeNodeContainer}`)}renderTree(){const e=this.getNodeContainer();this.config.dragAndDrop&&this.removeDragAndDropListeners(),e.innerHTML="",e.appendChild(this.renderUnorderedList(this.dataService.allNodes))}renderUnorderedList(e){var s,i;const l=document.createElement("ul");l.classList.add(t.SimpleTreeNodeContainerRoot);let r=null;var n;if((null===(s=this.searchTextInput)||void 0===s?void 0:s.value)&&this.config.highlightSearchResults&&(r=new RegExp(`(${n=null===(i=this.searchTextInput)||void 0===i?void 0:i.value,n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")})`,"ig")),e.forEach((e=>{var s,i;if(e.hidden)return;const n=(null===(s=e.children)||void 0===s?void 0:s.length)>0,o=document.createElement("li");o.id=e.uid,this.config.dragAndDrop&&!this.readOnly&&!(null===(i=this.searchTextInput)||void 0===i?void 0:i.value)&&e.draggable&&this.dragAndDropHandler.initialize(o);const d=document.createElement("div");d.classList.add(t.SimpleTreeNodeWrapper),d.addEventListener("mouseover",(()=>this.hoverNode(e))),d.addEventListener("mouseout",(()=>this.hoverNode(null))),e.cssClass&&d.classList.add(e.cssClass),n&&d.classList.add(t.SimpleTreeParentNode);const a=document.createElement("div");if(a.classList.add(t.SimpleTreeNodeText),this.addChevronDiv(d,e,n),this.config.checkboxes.active){const s=document.createElement("div");s.classList.add(t.SimpleTreeNodeCheckbox),this.readOnly||!this.config.checkboxes.recursive&&!e.selectable?s.classList.add(t.SimpleTreeNodeCheckboxDisabled):s.addEventListener("click",(()=>this.toggleCheckboxSelected(e))),e.selected&&s.classList.add(t.SimpleTreeNodeCheckboxSelected),d.appendChild(s)}else e.selected&&d.classList.add(t.SimpleTreeNodeSelected);a.innerHTML=this.formatNodeLabel(e.label,r),this.config.checkboxes.active||!e.selectable||this.readOnly||(d.addEventListener("click",(()=>this.toggleNodeSelected(e))),d.classList.add(t.SimpleTreeNodeSelectable)),d.appendChild(a),o.appendChild(d),l.appendChild(o),!e.collapsed&&n&&o.appendChild(this.renderUnorderedList(e.children))})),0===e.length){const e=document.createElement("li"),s=document.createElement("div");s.classList.add(t.SimpleTreeNodeWrapper);const i=document.createElement("div");i.classList.add(t.SimpleTreeNodeText),i.textContent=this.config.noNodesMessage,s.appendChild(i),e.appendChild(s),l.appendChild(e)}return l}toggleNodeSelected(e){const t=this.dataService.toggleNodeSelected(e.value);this.eventManager.publish(s._NodeSelected,t)}toggleCheckboxSelected(e){const t=this.dataService.toggleCheckboxSelected(e.value);this.eventManager.publish(s._NodeSelected,t)}addChevronDiv(e,s,i){const l=document.createElement("div");if(l.classList.add(t.SimpleTreeNodeChevronContainer),i){const e=document.createElement("div");s.collapsed?e.classList.add(t.SimpleTreeNodeChevronRight):e.classList.add(t.SimpleTreeNodeChevronDown),l.appendChild(e),l.addEventListener("click",(e=>{e.stopPropagation();const t=!s.collapsed;this.collapseNode(s,t)})),l.classList.add(t.SimpleTreeNodeChevronClickable)}e.appendChild(l)}collapseNode(e,t,s=!0){var i;e&&!e.hidden&&0!==(null===(i=e.children)||void 0===i?void 0:i.length)&&(e.collapsed=this.dataService.collapseNode(e.value,t),s&&this.renderTree())}collapseAllNodes(e){this.dataService.getNodesInternal().forEach((t=>this.collapseNode(t,e,!1))),this.renderTree()}setReadOnly(e){this.readOnly=e,this.searchTextInput&&(this.searchTextInput.disabled=e),this.keyEventHandler.setReadOnly(e)}formatNodeLabel(e,t){return t?o(e).replace(t,(e=>`<em>${e}</em>`)):o(e)}}class h{constructor(){this.eventLookup={}}publish(e,t,s){let i,l;if(!e)throw new Error("Event was invalid.");if(i=this.eventLookup[e],i)for(i=i.slice(),l=i.length;l--;)try{i[l](t,e,s)}catch(s){console.error(s)}}subscribe(e,t){const s=t;let i=[];if(!e)throw new Error("Event channel/type was invalid.");return i=this.eventLookup[e]||(this.eventLookup[e]=[]),i.push(s),{dispose(){const e=i.indexOf(s);-1!==e&&i.splice(e,1)}}}subscribeOnce(e,t){const s=this.subscribe(e,((e,i,l)=>(s.dispose(),t(e,i,l))));return s}}const c={label:"",value:"",selected:!1,selectable:!0,children:[],collapsed:!1,hidden:!1,uid:"",cssClass:"",draggable:!0};function p(e,t){let s=!1;for(const i of e){if(i.value===t){s=!0;break}if(i.children&&i.children.length>0){if(p(i.children,t)){s=!0;break}}}return s}class u{constructor(e,t=!1,s=!1){this.checkboxesActive=t,this.checkboxesRecursive=s,this.allNodes=[],this.treeInstanceId=Math.floor(1e3+9e3*Math.random()),this.allNodes=this.normalizeNodes(e)}normalizeNodes(e){return e.filter((e=>!!e)).map((e=>this.normalizeNode(e)))}normalizeNode(e){const t=this.copyNode(e);return t.uid=this.generateUid(e.value),this.mutateNode(t),t.children=this.normalizeNodes(t.children||[]),t}mutateNode(e){!e.selectable&&e.selected&&(e.selected=!1)}copyNode(e){return Object.assign(Object.assign({},c),e)}clear(){this.allNodes=[]}getNodesInternal(){return this.allNodes}getNodes(){return this.allNodes.map(this.copyNode)}getNode(e){const t=this.getNodeInternal(this.allNodes,e);return t?this.copyNode(t):null}getNodeInternal(e,t){for(const s of e){if(s.value===t)return s;if(s.children&&s.children.length>0){const e=this.getNodeInternal(s.children,t);if(e)return e}}return null}addNode(e,t=null){if(!(s=e)||!s.value||p(this.allNodes,e.value))throw new Error("node value is invalid or node with value already exists!");var s;const i=this.normalizeNode(e);if(t&&(this.isTreeNode(t)||"string"==typeof t)){const e=this.getNodeInternal(this.allNodes,this.isTreeNode(t)?t.value:t);this.isTreeNode(e)&&e.children.push(i)}else this.allNodes.push(i)}moveNode(e,t){var s;if(!e)return;const i=this.isTreeNode(e)?e.value:e,l=this.allNodes.some((e=>e.value===i))?this.allNodes:(null===(s=this.getParentForNode(this.allNodes,i))||void 0===s?void 0:s.children)||this.allNodes,r=l.findIndex((e=>e.value===i));if("up"===t&&r>0){const e=l[r];l[r]=l[r-1],l[r-1]=e}else if("down"===t&&r<l.length-1){const e=l[r];l[r]=l[r+1],l[r+1]=e}}isTreeNode(e){return void 0!==e.children}deleteNode(e){const t=this.allNodes.find((t=>t.value===e));if(t)this.allNodes.splice(this.allNodes.indexOf(t),1);else{const t=this.getParentForNode(this.allNodes,e);if(t){const s=t.children.find((t=>t.value===e));t.children.splice(t.children.indexOf(s),1)}}}setNodes(e){this.allNodes=this.normalizeNodes(e)}updateNodeLabel(e,t){const s=this.getNodeInternal(this.allNodes,e);s&&(s.label=t)}getParentForNode(e,t,s=null){s||(s=e=>e.value===t);for(const i of e){if(i.children&&i.children.some(s))return i;let e=null;if(i.children&&(e=this.getParentForNode(i.children,t,s)),e)return e}return null}getFlattedClickableNodeValues(){return this.flatten(this.allNodes).filter((e=>e.selectable&&!e.hidden)).map((e=>e.value))}flatten(e){return e.reduce(((e,t)=>t.children.length>0?(e.push(t),e.concat(this.flatten(t.children))):e.concat(t)),[])}filter(e,t){e?this.filterNodes(this.allNodes,!1,e.toLowerCase(),t):this.allNodes.forEach((e=>this.revertHiddenFlag(e,!1)))}revertHiddenFlag(e,t){e.hidden=t,e.children.forEach((t=>this.revertHiddenFlag(t,e.collapsed)))}filterNodes(e,t,s,i){let l=!1;return e.forEach((e=>{var r,n;const o="OnlyMatches"===i?null===(r=e.label)||void 0===r?void 0:r.toLowerCase().includes(s):(null===(n=e.label)||void 0===n?void 0:n.toLowerCase().includes(s))||t,d=this.filterNodes(e.children,o,s,i);o||d?(e.hidden=!1,l=!0):e.hidden=!0})),l}setSelected(...e){const t=e.map((e=>e.value));this.setSelectedNodes(this.allNodes,t),this.checkboxesActive&&this.checkboxesRecursive&&this.cleanRecursiveSelection(this.allNodes)}updateCheckboxState(e){var s;if(!this.checkboxesActive)return;const i=null===(s=document.getElementById(e.uid))||void 0===s?void 0:s.querySelector(`.${t.SimpleTreeNodeCheckbox}`);i?e.selected&&!i.classList.contains(t.SimpleTreeNodeCheckboxSelected)?i.classList.add(t.SimpleTreeNodeCheckboxSelected):!e.selected&&i.classList.contains(t.SimpleTreeNodeCheckboxSelected)&&i.classList.remove(t.SimpleTreeNodeCheckboxSelected):console.error("checkbox div not found for node!",e)}setSelectedNodes(e,t){e.forEach((e=>{(this.checkboxesRecursive||e.selectable)&&(e.selected=t.includes(e.value),this.updateCheckboxState(e)),e.children&&e.children.length>0&&this.setSelectedNodes(e.children,t)}))}cleanRecursiveSelection(e){let t=!0;return e.forEach((e=>{e.children&&e.children.length>0&&(e.selected?this.checkRecursiveChilds(e.children):(e.selected=this.cleanRecursiveSelection(e.children),this.updateCheckboxState(e))),t=t&&e.selected})),t}checkRecursiveChilds(e){e.forEach((e=>{e.selected=!0,this.updateCheckboxState(e),e.children&&e.children.length>0&&this.checkRecursiveChilds(e.children)}))}getSelected(){return this.getSelectedInternal(this.allNodes).map(this.copyNode)}getSelectedInternal(e,t=[]){return e.forEach((e=>{e.selected&&t.push(e),e.children&&e.children.length>0&&(t=this.getSelectedInternal(e.children,t))})),t}toggleNodeSelected(e){const t=this.getNodeInternal(this.allNodes,e);return t?(t.selected=!t.selected,this.copyNode(t)):(console.error(`node '${e}' to toggle not found!`),null)}toggleCheckboxSelected(e){let t=this.getNodeInternal(this.allNodes,e);if(!t)return console.error(`checkbox node '${e}' to toggle not found!`),null;const s=!t.selected;return t=this.toggleCheckboxNode(t,s),this.checkboxesRecursive&&this.toggleCheckboxParent(t),this.copyNode(t)}toggleCheckboxNode(e,s,i=!0){var l,r;const n=null===(l=document.getElementById(e.uid))||void 0===l?void 0:l.querySelector(`.${t.SimpleTreeNodeCheckbox}`);return n?(e.selected=s,e.selected&&!n.classList.contains(t.SimpleTreeNodeCheckboxSelected)?n.classList.add(t.SimpleTreeNodeCheckboxSelected):!e.selected&&n.classList.contains(t.SimpleTreeNodeCheckboxSelected)&&n.classList.remove(t.SimpleTreeNodeCheckboxSelected),this.checkboxesRecursive&&i&&(null===(r=e.children)||void 0===r?void 0:r.length)>0&&e.children.forEach((e=>this.toggleCheckboxNode(e,s))),e):(console.error("checkbox div not found!"),e)}toggleCheckboxParent(e){var t;const s=this.getParentForNode(this.allNodes,e.value);if(s&&(null===(t=s.children)||void 0===t?void 0:t.length)>0){const e=s.children.every((e=>!0===e.selected));this.toggleCheckboxNode(s,e,!1),this.toggleCheckboxParent(s)}}collapseNode(e,t){let s;return s="string"==typeof e?this.getNodeInternal(this.allNodes,e):e,s&&(s.collapsed=t&&s.children.length>0,s.children.forEach((e=>{e.hidden=t,this.collapseNode(e,t)}))),(null==s?void 0:s.collapsed)||!1}generateUid(e){let t=0;for(let s=0;s<e.length;s++){t=(t<<5)-t+e.charCodeAt(s),t|=0}return`${this.treeInstanceId}-${Math.abs(t)}`}setNodeIndex(e,t){const s=this.allNodes.find((t=>t.uid===e));if(s)return this.allNodes.splice(this.allNodes.indexOf(s),1),this.allNodes.splice(t,0,s),this.copyNode(s);{const s=this.getParentForNode(this.allNodes,e,(t=>t.uid===e));if(s){const i=s.children.find((t=>t.uid===e));return s.children.splice(s.children.indexOf(i),1),s.children.splice(t,0,i),this.copyNode(i)}}return null}}class v{constructor(e,t){this.element=e,this.options=t,this.readOnly=!1,this.subscriptions=[],this.eventManager=new h,this.dataService=new u(t.nodes,t.checkboxes.active,t.checkboxes.recursive)}isPrevented(e){const t=new CustomEvent(s.SelectionChanging,{cancelable:!0});return this.eventManager.publish(s.SelectionChanging,e,t),t.defaultPrevented}destroy(){this.tree.destroy(),Array.from(this.element.children).forEach((e=>this.element.removeChild(e))),this.dataService.clear(),this.subscriptions.forEach((e=>e.dispose())),this.subscriptions=[]}showEmphasizeIcon(e){throw new Error("Feature not supported in this mode!")}hideEmphasizeIcon(){throw new Error("Feature not supported in this mode!")}moveNode(e,t){throw new Error("Feature not supported in this mode!")}setSelected(e){this.selected=e}getSelected(){return this.selected}getNode(e){return this.dataService.getNode(e)}addNode(e,t=null){this.dataService.addNode(e,t),this.tree.renderTree()}deleteNode(e){this.dataService.deleteNode(e.value),this.tree.renderTree()}setNodes(e){this.dataService.setNodes(e),this.tree.renderTree()}updateNodeLabel(e,t){this.dataService.updateNodeLabel(e.value,t),this.tree.renderTree()}setReadOnly(e){this.readOnly!==e&&(this.readOnly=e,this.tree.setReadOnly(e),this.rootContainer.classList.toggle(t.SimpleTreeReadOnly,e),this.tree.renderContent())}subscribe(e,t){return this.eventManager.subscribe(e,t)}subscribeOnce(e,t){return this.eventManager.subscribeOnce(e,t)}collapseAllNodes(){this.tree.collapseAllNodes(!0)}expandAllNodes(){this.tree.collapseAllNodes(!1)}collapseNode(e){this.tree.collapseNode(e,!0)}expandNode(e){this.tree.collapseNode(e,!1)}toggleCollapseNode(e){this.tree.collapseNode(e,!e.collapsed)}}function m(e,t,s,i=300){const{top:l,left:r}=t.getBoundingClientRect(),n=window.scrollX,o=function(e,t,s,i=0,l=300){let r=e.top+e.height+i,n=s>l?l:s;return r-window.scrollY+n+10>t&&(r=e.top-n-i),r<0&&(r=e.top+e.height+i,n=t-r-10),{top:r,left:e.left-i,width:e.width-i,height:n}}({top:l+window.scrollY,height:t.offsetHeight,left:r+n,width:t.offsetWidth},window.innerHeight,s,parseInt(getComputedStyle(e).borderLeftWidth.replace("px",""),10),i);e.style.top=`${o.top}px`,e.style.left=`${o.left}px`,e.style.width=`${o.width}px`,e.style.height=`${o.height}px`}class g extends v{constructor(e,t){super(e,t),this.dropdownOpen=!1,this.subscriptions.push(this.eventManager.subscribe(s.EscapePressed,(()=>this.closeDropdown()))),this.boundClick=this.onClick.bind(this)}toggleDropdown(){this.dropdownOpen?this.closeDropdown():this.openDropdown()}onClick(e){const t=e.target;this.dropdownHolder.contains(t)||this.selectContainer.contains(t)||this.closeDropdown()}openDropdown(){this.readOnly||(this.tree.renderContent(),this.tree.activateKeyListener(),this.filterChangedSubscription=this.eventManager.subscribe(s.FilterChanged,(()=>this.calculateDropdownPosition())),this.options.css.dropdownHolder&&this.dropdownHolder.classList.add(this.options.css.dropdownHolder),this.dropdownHolder.style.top="-9999px",this.dropdownHolder.style.left="-9999px",this.dropdownHolder.style.display="inherit",this.calculateDropdownPosition(),this.arrowElement.classList.remove(t.SimpleTreeChevronDown),this.arrowElement.classList.add(t.SimpleTreeChevronUp),this.dropdownOpen=!0,window.addEventListener("mouseup",this.boundClick),this.options.scrollContainer&&(this.preventScrollListener=e=>{const t=this.dropdownHolder.querySelector(".simple-tree-node-container-root");(null==t?void 0:t.contains(e.target))||e.preventDefault()},this.options.scrollContainer.addEventListener("wheel",this.preventScrollListener,{passive:!1})))}closeDropdown(){this.dropdownOpen&&(this.filterChangedSubscription&&(this.filterChangedSubscription.dispose(),this.filterChangedSubscription=null),this.options.css.dropdownHolder&&this.dropdownHolder.classList.remove(this.options.css.dropdownHolder),this.dropdownHolder.style.display="none",this.dropdownHolder.style.top="",this.dropdownHolder.style.left="",this.dropdownHolder.style.width="",this.dropdownHolder.style.height="",this.arrowElement.classList.remove(t.SimpleTreeChevronUp),this.arrowElement.classList.add(t.SimpleTreeChevronDown),this.dropdownOpen=!1,window.removeEventListener("mouseup",this.boundClick),this.tree.deactivateKeyListener(),this.options.scrollContainer&&this.preventScrollListener&&(this.options.scrollContainer.removeEventListener("wheel",this.preventScrollListener),this.preventScrollListener=null))}calculateDropdownPosition(){let e=0;this.options.searchBar?(e+=this.dropdownHolder.children[0].clientHeight,e+=this.dropdownHolder.children[1].scrollHeight):e+=this.dropdownHolder.children[0].scrollHeight,m(this.dropdownHolder,this.selectContainer.parentElement,e,this.options.defaultDropdownHeight)}updateClearButton(e){const i=Array.isArray(this.selected)?this.selected.length>0:this.selected;this.options.clearButton&&i&&!this.clearElement?(this.clearElement=document.createElement("i"),this.clearElement.classList.add(t.SimpleTreeCross),this.clearElement.onclick=t=>{this.readOnly||(this.setSelected(e),this.eventManager.publish(s.SelectionChanged,e)),t.stopPropagation()},this.selectContainer.appendChild(this.clearElement),this.selectContainer.classList.add(t.SimpleTreeClearable)):!i&&this.clearElement&&(this.clearElement.remove(),this.clearElement=null)}}class S extends g{constructor(e,i){super(e,i),this.rootContainer=r(e,t.SimpleTree),this.selected=this.dataService.getSelected()[0]||null,this.dropdownHolder=n(),this.tree=new a(this.dropdownHolder,i,this.dataService,this.eventManager,this.readOnly),this.subscriptions.push(this.subscribe(s._NodeSelected,(e=>this.nodeSelected(e)))),this.renderSelectField(this.rootContainer)}setSelected(e){e?this.dataService.setSelected(e):this.dataService.setSelected(),super.setSelected(this.dataService.getSelected()[0]||null),this.updateUiOnSelection(),this.tree.highlightNode(e)}setReadOnly(e){super.setReadOnly(e),e&&this.dropdownOpen&&this.closeDropdown()}showEmphasizeIcon(e){this.emphasisCssClass=e,this.selected&&this.emphasisCssClass&&!this.emphasizeElement&&(this.selectContainer.classList.add(t.SimpleTreeEmphasized),this.emphasizeElement=document.createElement("i"),this.emphasizeElement.classList.add(t.SimpleTreeEmphasize,e),this.selectContainer.appendChild(this.emphasizeElement))}hideEmphasizeIcon(){this.emphasisCssClass=null,this.emphasizeElement&&(this.selectContainer.classList.remove(t.SimpleTreeEmphasized),this.selectContainer.removeChild(this.emphasizeElement),this.emphasizeElement=null)}nodeSelected(e){this.isPrevented(e)||(this.dataService.setSelected(e),this.selected=this.dataService.getSelected()[0]||null,this.tree.highlightNode(e),this.updateUiOnSelection(),this.closeDropdown(),this.eventManager.publish(s.SelectionChanged,this.selected))}renderSelectField(e){this.selectContainer=r(e,t.SimpleTreeSingleSelectBox),this.selectContainer.onclick=()=>!this.readOnly&&this.toggleDropdown(),this.selectedLabel=document.createElement("span"),this.selectedLabel.classList.add(t.SimpleTreeSelectedLabel),this.selectContainer.appendChild(this.selectedLabel),this.updateUiOnSelection(),this.arrowElement=document.createElement("i"),this.arrowElement.classList.add(t.SimpleTreeChevronDown),this.selectContainer.appendChild(this.arrowElement)}updateUiOnSelection(){if(this.selectedLabel.innerHTML=this.selected?this.options.templateSelectedText(this.selected):this.options.watermark,this.selectedLabel.classList.toggle(t.SimpleTreeSelectedLabelWatermark,!this.selected),this.emphasisCssClass&&this.selected)this.showEmphasizeIcon(this.emphasisCssClass);else if(!this.selected){const e=this.emphasisCssClass;this.hideEmphasizeIcon(),this.emphasisCssClass=e}this.updateClearButton(null)}}class N extends g{constructor(e,i){super(e,i),this.rootContainer=r(e,t.SimpleTree),this.selected=this.dataService.getSelected(),this.dropdownHolder=n(),this.tree=new a(this.dropdownHolder,i,this.dataService,this.eventManager,this.readOnly),this.subscriptions.push(this.subscribe(s._NodeSelected,(e=>this.nodeSelected(e)))),this.renderSelectField(this.rootContainer)}setSelected(e){this.dataService.setSelected(...e||[]),super.setSelected(this.dataService.getSelected()),this.renderPillboxes()}setReadOnly(e){super.setReadOnly(e),e&&this.dropdownOpen&&this.closeDropdown()}destroy(){super.destroy(),this.pillboxContainer&&(this.pillboxContainer.innerHTML="")}nodeSelected(e){if(this.isPrevented(e))return;const t=this.selected.findIndex((t=>t.value===e.value));-1!==t?(e.selected=!1,this.selected.splice(t,1)):(e.selected=!0,this.selected.push(e)),this.dataService.setSelected(...this.selected),this.selected=this.dataService.getSelected(),this.renderPillboxes(),this.closeDropdown(),this.eventManager.publish(s.SelectionChanged,this.selected)}renderSelectField(e){this.selectContainer=r(e,t.SimpleTreeMultiSelectBox),this.selectContainer.onclick=()=>!this.readOnly&&this.toggleDropdown(),this.pillboxContainer=function(e,...t){return l(e,"ul",...t)}(this.selectContainer,t.SimpleTreePillboxHolder),this.renderPillboxes(),this.arrowElement=document.createElement("i"),this.arrowElement.classList.add(t.SimpleTreeChevronDown),this.selectContainer.appendChild(this.arrowElement)}renderPillboxes(){this.pillboxContainer.innerHTML="",this.selected.forEach((e=>{const s=function(e,...t){return l(e,"li",...t)}(this.pillboxContainer,"");s.innerHTML=this.options.templateSelectedText(e);r(s,t.SimpleTreePillboxCross).addEventListener("click",(t=>{this.readOnly||this.nodeSelected(e),t.stopPropagation()}))})),this.updateClearButton([])}}class b extends v{constructor(e,i){super(e,i),this.rootContainer=r(e,t.SimpleTree,t.SimpleTreeViewOnly),i.checkboxes.active?this.selected=this.dataService.getSelected():this.selected=this.dataService.getSelected()[0]||null,this.tree=new a(this.rootContainer,i,this.dataService,this.eventManager,this.readOnly),this.subscriptions.push(this.subscribe(s._NodeSelected,(e=>this.nodeSelected(e)))),this.tree.renderContent(),this.tree.activateKeyListener()}setSelected(e){this.options.checkboxes.active?(this.dataService.setSelected(...e||[]),super.setSelected(this.dataService.getSelected())):(this.dataService.setSelected(e||[]),super.setSelected(this.dataService.getSelected()[0]||[]),this.tree.highlightNode(e))}moveNode(e,t){this.dataService.moveNode(e,t),this.tree.renderTree()}nodeSelected(e){var t;this.isPrevented(e)||(this.options.checkboxes.active?this.selected=this.dataService.getSelected():(null==e?void 0:e.value)===(null===(t=this.selected)||void 0===t?void 0:t.value)?(this.dataService.setSelected(),this.selected=null,this.tree.highlightNode(null)):(this.dataService.setSelected(e),this.selected=this.dataService.getSelected()[0]||null,this.tree.highlightNode(e)),this.eventManager.publish(s.SelectionChanged,this.selected))}}function C(t,s,i){const l=Object.assign(Object.assign({},e),i);return"singleSelectDropdown"===s?new S(t,l):"multiSelectDropdown"===s?new N(t,l):new b(t,l)}function f(e,t,s){const i=Array.prototype.slice.call(e).filter((e=>e instanceof HTMLElement)),l=[];for(let e=0;e<i.length;e++){const r=i[e];try{void 0!==r._simpleTree&&(r._simpleTree.destroy(),r._simpleTree=void 0),r._simpleTree=C(r,t,s||{}),l.push(r._simpleTree)}catch(e){console.error(e)}}return 1===l.length?l[0]:l}return function(e,t,s){return"string"==typeof e?f(window.document.querySelectorAll(e),t,s):e instanceof Node?f([e],t,s):f(e,t,s)}}));